{
  "info": {
    "name": "Nush API Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login Customer",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/auth/login",
              "host": ["http://localhost:5001/api"],
              "path": ["auth", "login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"email\":\"{{customer_email}}\",\"password\":\"{{customer_password}}\"}"
            }
          }
        },
        {
          "name": "Get Me",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/auth/me",
              "host": ["http://localhost:5001/api"],
              "path": ["auth", "me"]
            }
          }
        }
      ]
    },
    {
      "name": "Restaurants",
      "item": [
        {
          "name": "List Restaurants",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/restaurants?limit=10&offset=0",
              "host": ["http://localhost:5001/api"],
              "path": ["restaurants"],
              "query": [
                { "key": "limit", "value": "10" },
                { "key": "offset", "value": "0" }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const json = pm.response.json();",
                  "if (json.data && json.data.restaurants && json.data.restaurants.length) {",
                  "  pm.collectionVariables.set('restaurant_id', json.data.restaurants[0].id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Restaurant",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/restaurants/{{restaurant_id}}",
              "host": ["http://localhost:5001/api"],
              "path": ["restaurants", "{{restaurant_id}}"]
            }
          }
        },
        {
          "name": "Get Menu",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/restaurants/{{restaurant_id}}/menu",
              "host": ["http://localhost:5001/api"],
              "path": ["restaurants", "{{restaurant_id}}", "menu"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const json = pm.response.json();",
                  "if (json.data && json.data.categories && json.data.categories.length) {",
                  "  const cat = json.data.categories[0];",
                  "  pm.collectionVariables.set('category_id', cat.id);",
                  "  if (cat.items && cat.items.length) {",
                  "    pm.collectionVariables.set('menu_item_id', cat.items[0].id);",
                  "  }",
                  "  pm.collectionVariables.set('menu_id', json.data.id);",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Cart + Checkout",
      "item": [
        {
          "name": "Create Cart",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/cart",
              "host": ["http://localhost:5001/api"],
              "path": ["cart"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"restaurant_id\":\"{{restaurant_id}}\",\"order_type\":\"pickup\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const json = pm.response.json();",
                  "if (json.data && json.data.cart) {",
                  "  pm.collectionVariables.set('cart_id', json.data.cart.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Add Item",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/cart/items",
              "host": ["http://localhost:5001/api"],
              "path": ["cart", "items"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cart_id\":\"{{cart_id}}\",\"menu_item_id\":\"{{menu_item_id}}\",\"quantity\":1}"
            }
          }
        },
        {
          "name": "Apply Promo",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/cart/apply-promo",
              "host": ["http://localhost:5001/api"],
              "path": ["cart", "apply-promo"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cart_id\":\"{{cart_id}}\",\"code\":\"{{promo_code}}\"}"
            }
          }
        },
        {
          "name": "Checkout Validate",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/checkout/validate",
              "host": ["http://localhost:5001/api"],
              "path": ["checkout", "validate"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cart_id\":\"{{cart_id}}\"}"
            }
          }
        },
        {
          "name": "Checkout Create Intent",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/checkout/create-intent",
              "host": ["http://localhost:5001/api"],
              "path": ["checkout", "create-intent"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cart_id\":\"{{cart_id}}\"}"
            }
          }
        },
        {
          "name": "Checkout Confirm",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/checkout/confirm",
              "host": ["http://localhost:5001/api"],
              "path": ["checkout", "confirm"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"cart_id\":\"{{cart_id}}\",\"pickup_window\":{\"start\":\"2024-01-01T12:00:00+00:00\",\"end\":\"2024-01-01T12:30:00+00:00\"}}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const json = pm.response.json();",
                  "if (json.data && json.data.order) {",
                  "  pm.collectionVariables.set('order_id', json.data.order.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "List Orders",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/orders?limit=10&offset=0",
              "host": ["http://localhost:5001/api"],
              "path": ["orders"],
              "query": [
                { "key": "limit", "value": "10" },
                { "key": "offset", "value": "0" }
              ]
            }
          }
        },
        {
          "name": "Get Order",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/orders/{{order_id}}",
              "host": ["http://localhost:5001/api"],
              "path": ["orders", "{{order_id}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Login Admin",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/auth/login",
              "host": ["http://localhost:5001/api"],
              "path": ["auth", "login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"email\":\"{{admin_email}}\",\"password\":\"{{admin_password}}\"}"
            }
          }
        },
        {
          "name": "List Users",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/admin/users?limit=10&offset=0",
              "host": ["http://localhost:5001/api"],
              "path": ["admin", "users"],
              "query": [
                { "key": "limit", "value": "10" },
                { "key": "offset", "value": "0" }
              ]
            }
          }
        },
        {
          "name": "List Restaurants",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/admin/restaurants?limit=10&offset=0",
              "host": ["http://localhost:5001/api"],
              "path": ["admin", "restaurants"],
              "query": [
                { "key": "limit", "value": "10" },
                { "key": "offset", "value": "0" }
              ]
            }
          }
        },
        {
          "name": "List Orders",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/admin/orders?limit=10&offset=0",
              "host": ["http://localhost:5001/api"],
              "path": ["admin", "orders"],
              "query": [
                { "key": "limit", "value": "10" },
                { "key": "offset", "value": "0" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Restaurant Admin",
      "item": [
        {
          "name": "Login Owner",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/auth/login",
              "host": ["http://localhost:5001/api"],
              "path": ["auth", "login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"email\":\"{{owner_email}}\",\"password\":\"{{owner_password}}\"}"
            }
          }
        },
        {
          "name": "List Managed Restaurants",
          "request": {
            "method": "GET",
            "url": {
              "raw": "http://localhost:5001/api/restaurant-admin/restaurants",
              "host": ["http://localhost:5001/api"],
              "path": ["restaurant-admin", "restaurants"]
            }
          }
        },
        {
          "name": "Create Menu Item",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "http://localhost:5001/api/restaurant-admin/menus/{{menu_id}}/items",
              "host": ["http://localhost:5001/api"],
              "path": ["restaurant-admin", "menus", "{{menu_id}}", "items"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\"name\":\"Test Bowl\",\"base_price_cents\":1299,\"category_id\":\"{{category_id}}\"}"
            }
          }
        }
      ]
    }
  ]
}
